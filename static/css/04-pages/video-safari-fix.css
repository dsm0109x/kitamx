/**
 * Safari/iOS Video Transparency Fix
 * Soluciona el problema de fondos negros en videos con transparencia en Safari
 *
 * PROBLEMA: Safari no soporta bien el canal alpha en videos WebM y algunos MP4
 * SOLUCIÓN: Usar MP4 con HEVC codec + CSS específico para Safari
 */

/* Base styles para videos con transparencia */
.demo-gif-direct {
    width: 100%;
    max-width: 600px;
    height: auto;
    display: block;
    margin: 0 auto;

    /* Eliminar cualquier color de fondo por defecto */
    background: transparent !important;
    background-color: transparent !important;

    /* Mejorar rendering en Safari */
    -webkit-transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    transform: translateZ(0);
    backface-visibility: hidden;

    /* Forzar aceleración por hardware */
    will-change: transform;

    /* Bordes redondeados suaves */
    border-radius: 8px;
    overflow: hidden;

    /* Sombra sutil para separar del fondo */
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* Safari-specific hacks usando -webkit prefix detection */
@supports (-webkit-appearance: none) and (not (-moz-appearance: none)) {
    .demo-gif-direct {
        /* Safari-specific optimizations */
        -webkit-mask-image: -webkit-radial-gradient(white, black);
        mask-image: radial-gradient(white, black);

        /* Mejorar composición de transparencia */
        isolation: isolate;
        mix-blend-mode: normal;
    }

    /* Container del video en Safari */
    .timeline-detail video,
    .invoice-step-flow video {
        /* Asegurar que el container no añada fondo */
        background: transparent !important;
    }
}

/* iOS-specific (usando media query para touch) */
@supports (-webkit-touch-callout: none) {
    .demo-gif-direct {
        /* iOS optimizations */
        -webkit-tap-highlight-color: transparent;

        /* Prevenir el tinte negro en iOS */
        -webkit-mask-box-image: initial;
    }
}

/* Fallback: Si el video tiene fondo negro, aplicar un fondo blanco sutil */
@media (hover: none) and (pointer: coarse) {
    /* Dispositivos táctiles (principalmente móviles) */
    .demo-gif-direct {
        /* Fondo blanco muy sutil como fallback */
        background: rgba(248, 250, 252, 0.5) !important;
    }
}

/* Fix para el contenedor padre en la timeline */
.timeline-detail-with-bg .demo-gif-direct {
    /* Heredar el fondo del contenedor si es necesario */
    background: inherit;
}

/* Asegurar que los controles no se muestren (están deshabilitados pero por si acaso) */
.demo-gif-direct::-webkit-media-controls {
    display: none !important;
}

.demo-gif-direct::-webkit-media-controls-enclosure {
    display: none !important;
}

/* Para debugging: añadir borde para ver el área real del video */
.debug-video-border .demo-gif-direct {
    border: 2px solid red;
    background: rgba(255, 0, 0, 0.1);
}

/* Animación de fade-in suave para cuando el video carga */
@keyframes videoFadeIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.demo-gif-direct {
    animation: videoFadeIn 0.3s ease-out forwards;
}

/* Media query para pantallas pequeñas */
@media (max-width: 768px) {
    .demo-gif-direct {
        max-width: 100%;
        box-shadow: none; /* Quitar sombra en móvil para mejor performance */
    }
}