{% extends 'base_minimal.html' %}
{% load static %}

{% block title %}Recuperar Contraseña - Kita{% endblock %}

{% block extra_head %}
<!-- Auth Brutalist Styles -->
<link rel="stylesheet" href="{% static 'css/04-pages/auth-brutalist.css' %}?v=2.4">

<!-- Cloudflare Turnstile -->
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
{% endblock %}

{% block content %}
<main role="main" class="auth-page-centered">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-7 col-sm-10">
                <div class="auth-form-card">
                    <!-- Header -->
                    <div class="auth-header text-center mb-4">
                        <div class="d-flex align-items-center justify-content-center gap-2 mb-3">
                            <img src="{% static logo_path %}"
                                 alt="Kita"
                                 height="48"
                                 loading="eager"
                                 class="auth-logo">
                            <h1 class="kita-brand mb-0">Kita</h1>
                        </div>
                        <p class="auth-tagline">Kit de Ayuda para Emprendedores</p>

                        <h2 class="auth-title">Recuperar Contraseña</h2>
                        <p class="auth-subtitle">Ingresa tu email y te enviaremos un enlace seguro</p>

                        <!-- Trust Badges -->
                        <div class="auth-trust-badges">
                            <span class="trust-badge">
                                <span class="iconoir-lock" aria-hidden="true"></span>
                                Enlace seguro
                            </span>
                            <span class="trust-badge">
                                <span class="iconoir-mail" aria-hidden="true"></span>
                                Por email
                            </span>
                        </div>
                    </div>

                <!-- Form -->
                <form method="post" class="auth-form" aria-label="Formulario de recuperación de contraseña">
                    {% csrf_token %}

                    <!-- Email Field -->
                    <div class="form-group">
                        <label for="{{ form.email.id_for_label }}" class="form-label">
                            Correo electrónico
                        </label>
                        {{ form.email }}
                        {% if form.email.errors %}
                            <div class="form-error" role="alert">
                                {% for error in form.email.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Helper Text -->
                    <div class="auth-helper-text">
                        <span class="iconoir-info-circle" aria-hidden="true"></span>
                        Revisa tu bandeja de entrada y carpeta de spam
                    </div>

                    <!-- Cloudflare Turnstile Widget (Normal Mode) -->
                    <div class="mb-3">
                        <div class="cf-turnstile"
                             data-sitekey="{{ TURNSTILE_SITE_KEY }}"
                             data-callback="onTurnstileSuccess"
                             data-error-callback="onTurnstileError"
                             data-theme="light"
                             data-size="normal"></div>
                        {{ form.cf_turnstile_response }}
                        {% if form.cf_turnstile_response.errors %}
                            <div class="form-error" role="alert">
                                {% for error in form.cf_turnstile_response.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Non-field Errors -->
                    {% if form.non_field_errors %}
                        <div class="form-error-global" role="alert">
                            {% for error in form.non_field_errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}

                    <!-- Submit Button -->
                    <div class="d-grid mb-3">
                        <button type="submit"
                                class="btn btn-accent btn-lg"
                                id="resetSubmit"
                                data-tracking="password-reset-submit">
                            <span class="iconoir-send" aria-hidden="true"></span>
                            <span class="btn-text">Enviar Enlace de Recuperación</span>
                        </button>
                    </div>
                </form>

                <!-- Divider -->
                <div class="auth-divider">
                    <span>o</span>
                </div>

                <!-- Navigation Links -->
                <div class="auth-login-link text-center">
                    <p class="text-muted">¿Recordaste tu contraseña?</p>
                    <a href="{% url 'account_login' %}"
                       class="btn btn-outline-secondary w-100 mb-3"
                       data-tracking="reset-to-login">
                        <span class="btn-text">Volver al Login</span>
                    </a>

                    <div class="text-center">
                        <a href="{% url 'account_signup' %}"
                           class="link-muted"
                           data-tracking="reset-to-signup">
                            <span class="iconoir-user-plus" aria-hidden="true"></span>
                            ¿No tienes cuenta? Regístrate gratis
                        </a>
                    </div>
                </div>

                <!-- Back to Home -->
                <div class="auth-back-link text-center">
                    <a href="{% url 'home' %}" data-tracking="reset-back-home">
                        <span class="iconoir-arrow-left" aria-hidden="true"></span>
                        Volver al inicio
                    </a>
                </div>

                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_js %}
<!-- Auth Password Reset Enhanced - AJAX + Validación en tiempo real + Multi-stage loading -->
<script src="{% static 'js/auth-password-reset-enhanced.js' %}?v=2.0" defer></script>
{% endblock %}
