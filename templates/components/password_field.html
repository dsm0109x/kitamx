{#
    PASSWORD FIELD COMPONENT - WITH TOGGLE
    =======================================

    Componente especializado para campos de contraseña con toggle show/hide.
    Wrapper alrededor de form_field.html con funcionalidad extra.

    Usage:
        {% include 'components/password_field.html' with field=form.password1 %}

    Optional parameters:
        - field: Django form field (required)
        - help_text: Custom help text
        - placeholder: Custom placeholder
        - show_label: Boolean, default True
        - required_indicator: Boolean, default True
        - autocomplete: HTML autocomplete attribute (default: "current-password")
        - error_style: 'bootstrap' or 'legacy', default 'bootstrap'
        - show_toggle: Boolean, default True (show password visibility toggle)

    Features:
        ✅ Password visibility toggle button
        ✅ Inherits all form_field.html features
        ✅ Accessible toggle with aria-label
        ✅ Icon toggle (eye/eye-off)

    @version 1.0
    @created 2025-10-21
#}

{# Generate unique IDs #}
{% with field_id=field.id_for_label|default:field.html_name %}
{% with error_id="error_"|add:field_id %}
{% with help_id="help_"|add:field_id %}

<div class="form-group{% if field.errors %} has-error{% endif %}{% if wrapper_class %} {{ wrapper_class }}{% endif %}">
    {# Label #}
    {% if show_label|default:True %}
        <label for="{{ field_id }}" class="form-label">
            {{ field.label }}
            {% if field.field.required and required_indicator|default:True %}
                <span class="text-danger" aria-label="requerido">*</span>
            {% endif %}
        </label>
    {% endif %}

    {# Password Input with Toggle Wrapper #}
    <div class="password-wrapper">
        <input type="password"
               name="{{ field.html_name }}"
               id="{{ field_id }}"
               class="form-control{% if field.errors %} is-invalid{% endif %}{% if input_class %} {{ input_class }}{% endif %}"
               {% if placeholder %}placeholder="{{ placeholder }}"{% else %}placeholder="Ingresa tu contraseña"{% endif %}
               {% if autocomplete %}autocomplete="{{ autocomplete }}"{% else %}autocomplete="current-password"{% endif %}
               {% if field.value %}value="{{ field.value }}"{% endif %}
               {% if field.field.required %}required{% endif %}
               aria-describedby="{% if field.errors %}{{ error_id }}{% else %}{{ help_id }}{% endif %}"
               {% if field.errors %}aria-invalid="true"{% endif %}>

        {# Toggle Button #}
        {% if show_toggle|default:True %}
            <button type="button"
                    class="password-toggle"
                    data-target="{{ field_id }}"
                    aria-label="Mostrar contraseña">
                <span class="iconoir-eye toggle-icon" aria-hidden="true"></span>
            </button>
        {% endif %}
    </div>

    {# Error Messages - Backward Compatible #}
    {% if field.errors %}
        {% if error_style == 'legacy' %}
            {# Legacy style (.form-error) #}
            <div class="form-error" id="{{ error_id }}" role="alert">
                {% for error in field.errors %}
                    <small class="d-block">{{ error }}</small>
                {% endfor %}
            </div>
        {% else %}
            {# Bootstrap style (.invalid-feedback) #}
            <div class="invalid-feedback d-block" id="{{ error_id }}" role="alert">
                {% for error in field.errors %}
                    <span class="d-block">{{ error }}</span>
                {% endfor %}
            </div>
        {% endif %}
    {% endif %}

    {# Help Text #}
    {% if help_text or field.help_text %}
        {% if not field.errors %}
            <small id="{{ help_id }}" class="form-text text-muted">
                {{ help_text|default:field.help_text }}
            </small>
        {% endif %}
    {% endif %}
</div>

{# Password toggle is handled by global script in auth-brutalist.css or via component JS below #}

{% endwith %}
{% endwith %}
{% endwith %}
