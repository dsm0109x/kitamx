{% extends "emails/base.html" %}
{% load email_filters %}

{% block email_title %}Â¡Pago Recibido Exitosamente! - {{ tenant.name }}{% endblock %}

{% block email_content %}
<!-- Icon Hero -->
<div style="text-align: center; margin-bottom: 24px;">
    <div style="font-size: 64px; line-height: 1;">âœ…</div>
</div>

<!-- Title -->
<h1 style="font-family: 'Inter', sans-serif; font-size: 26px; font-weight: 700; color: #111827; text-align: center; margin: 0 0 16px 0; line-height: 1.3;">
    Â¡Pago Recibido Exitosamente!
</h1>

<!-- Lead Text -->
<p class="lead" style="font-size: 16px; color: #6B7280; text-align: center; margin: 0 0 32px 0;">
    Hola {% if recipient_name %}{{ recipient_name }}{% else %}Cliente{% endif %},
</p>

<!-- Main Message -->
<p style="font-size: 16px; color: #374151; line-height: 1.6; margin: 0 0 24px 0;">
    Â¡Gracias por tu pago! Hemos recibido y confirmado tu transacciÃ³n exitosamente.
    {% if requires_invoice %}
    Ahora puedes generar tu factura CFDI 4.0.
    {% else %}
    Tu comprobante ha sido procesado.
    {% endif %}
</p>

<!-- Success Box - ConfirmaciÃ³n -->
<div class="success-box" style="background-color: #f0fdf4; border: 2px solid #bbf7d0; border-radius: 12px; padding: 20px; margin: 24px 0;">
    <h3 style="font-family: 'Inter', sans-serif; font-size: 16px; font-weight: 700; color: #14532d; margin: 0 0 12px 0;">
        ğŸ’° Detalles de tu Pago
    </h3>
    <ul style="margin: 0; padding-left: 20px; color: #166534;">
        <li style="margin-bottom: 8px;">
            <strong>Monto pagado:</strong> ${{ amount|currency_mx }} MXN
        </li>
        <li style="margin-bottom: 8px;">
            <strong>Concepto:</strong> {{ title }}
        </li>
        <li style="margin-bottom: 8px;">
            <strong>Fecha:</strong> {{ paid_at|friendly_datetime }}
        </li>
        <li style="margin-bottom: 8px;">
            <strong>ID de pago:</strong> {{ payment_id }}
        </li>
    </ul>
</div>

{% if requires_invoice %}
<!-- CTA Button - Generar Factura -->
<div style="text-align: center; margin: 32px 0;">
    <a href="{{ billing_form_url }}" class="btn-primary" style="background-color: #15803d; color: #ffffff; padding: 16px 32px; text-decoration: none; border-radius: 9999px; font-weight: 600; font-size: 16px; display: inline-block; box-shadow: 0 4px 6px rgba(21, 128, 61, 0.15);">
        ğŸ“„ Generar mi Factura CFDI 4.0
    </a>
</div>

<!-- Info Box - Factura -->
<div class="info-box" style="background-color: #FEF3C7; border: 2px solid #FDE68A; border-radius: 12px; padding: 20px; margin: 24px 0;">
    <h3 style="font-family: 'Inter', sans-serif; font-size: 16px; font-weight: 700; color: #92400E; margin: 0 0 12px 0;">
        ğŸ“‹ Para Generar tu Factura
    </h3>
    <ol style="margin: 0; padding-left: 20px; color: #78350F;">
        <li style="margin-bottom: 8px;">Haz clic en el botÃ³n "Generar mi Factura"</li>
        <li style="margin-bottom: 8px;">Ingresa tu RFC y razÃ³n social</li>
        <li style="margin-bottom: 8px;">Selecciona el uso de CFDI</li>
        <li>RecibirÃ¡s tu XML y PDF por email en unos minutos</li>
    </ol>
</div>
{% else %}
<!-- Info Box - Sin factura -->
<div class="info-box" style="background-color: #FEF3C7; border: 2px solid #FDE68A; border-radius: 12px; padding: 20px; margin: 24px 0;">
    <p style="margin: 0; font-size: 14px; color: #78350F;">
        ğŸ’¡ <strong>Nota:</strong> Este pago no incluye factura. Si la necesitas, contacta a {{ tenant.name }}.
    </p>
</div>
{% endif %}

<!-- Security Note -->
<div class="security-box" style="background-color: #F3F4F6; border: 2px solid #E5E7EB; border-radius: 12px; padding: 20px; margin: 24px 0;">
    <p style="margin: 0; font-size: 14px; color: #6B7280;">
        ğŸ”’ Este pago fue procesado de forma segura a travÃ©s de MercadoPago.
        Tu informaciÃ³n financiera estÃ¡ protegida con los mÃ¡s altos estÃ¡ndares de seguridad.
    </p>
</div>

{% if billing_form_url %}
<!-- Fallback Link -->
<div class="link-fallback" style="margin-top: 32px; padding-top: 24px; border-top: 1px solid #E5E7EB; text-align: center;">
    <p style="font-size: 13px; color: #9CA3AF; margin: 0 0 8px 0;">
        Â¿El botÃ³n no funciona? Copia y pega este enlace:
    </p>
    <p style="margin: 0;">
        <a href="{{ billing_form_url }}" style="color: #15803d; word-break: break-all; font-size: 12px;">{{ billing_form_url }}</a>
    </p>
</div>
{% endif %}

<!-- Help -->
<p style="font-size: 14px; color: #6B7280; text-align: center; margin: 24px 0 0 0;">
    Â¿Alguna duda?{% if tenant.support_email or tenant.email %} ContÃ¡ctanos en
    <a href="mailto:{{ tenant.support_email|default:tenant.email }}" style="color: #15803d; text-decoration: none;">{{ tenant.support_email|default:tenant.email }}</a>{% else %} Responde a este email{% endif %}
</p>
{% endblock %}

{% block email_footer_note %}
Este email de confirmaciÃ³n fue enviado por {{ tenant.name }} a travÃ©s de Kita.
{% endblock %}
